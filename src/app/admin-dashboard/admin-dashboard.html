<div class="page-wrapper">

  <nav class="glass-nav">
    <div class="nav-brand">WAYPLOT <span class="badge">ADMIN</span></div>
    <div class="btn-nav">
      <button class="btn btn-primary" routerLink="/usermanagement">
        <span>üë§</span> User Management
      </button>
      <button class="btn btn-primary" routerLink="/analyticsdashboard" >
        <span>üìä</span> View Analytics
      </button>
      <button class="btn btn-secondary" (click)="signOut()">
        üîí Sign Out
      </button>
    </div>
  </nav>

  <div class="dashboard-grid">

    <section class="main-content">
      <div class="glass-panel">

        <div class="panel-header">
          <h2>Your Maps</h2>

          <div class="upload-wrapper">
            <button class="btn btn-primary" (click)="openDialog() ">
              üìÑ Upload Map (.gpx)
            </button>
          </div>
        </div>

        <div class="map-list">
          <div class="map-item" *ngFor="let item of maps">
            <div class="map-item-content">
              <div class="map-icon-box">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                  stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polygon points="1 6 1 22 8 18 16 22 21 18 21 2 16 6 8 2 1 6"></polygon>
                  <line x1="8" y1="2" x2="8" y2="18"></line>
                  <line x1="16" y1="6" x2="16" y2="22"></line>
                </svg>
              </div>
              <div class="map-info">
                <h3>{{item.name}}</h3>
                <span>{{item.description}}</span>
                <p>{{item.createdAt|date:'dd-MM-yyyy'}} <br> üëÅÔ∏è {{item.views}} views | ‚è¨ {{item.downloads}} exports </p>
              </div>
              <div class="map-meta">
                @if(item.status===2){
                  <span class="status status-active">Deleted</span>
                }
                @else {
                  <span class="status status-active">{{(item.status == 0) ? 'Active':'Inactive'}}</span>
                }
                <button (click)="viewMap(item.jsonUrl, item.name)" class="btn btn-primary">
                  View Map
                </button>
                
                <div class="menu-wrapper">

                  <button class="btn-icon" (click)="toggleMenu(item.id)">‚ãÆ</button>

                  @if (activeMenuId===item.id) {
                  <div class="dropdown-menu" (click)="$event.stopPropagation()">
                    <button class="menu-item" (click)="OnEdit(item)">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                      </svg>
                      Edit
                    </button>
                    <button class="menu-item" (click)="OnDownload(item)">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                      </svg>
                      Export
                    </button>
                    <button class="menu-item delete" (click)="OnDelete(item)">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2">
                        <polyline points="3 6 5 6 21 6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                      </svg>
                      Delete
                    </button>
                  </div>
                  }

                </div>
              </div>
            </div>
            @if (activeEditId===item.id) {
            <div class="map-do-edit">
              <form class="edit-map-form" (ngSubmit)="OnSave()" #postForm="ngForm">
                <div>
                  <label for="mapname">Map Name: </label>
                  <input type="text" name="mapname" [(ngModel)]="editableMap!.name" required placeholder="Enter the Map Name">
                </div>
                <div>
                  <label for="mapgpxurl">Map gpx_url: </label>
                  <input type="text" name="mapgpxurl" [(ngModel)]="editableMap!.gpxUrl" required placeholder="Enter the url">
                </div>
                <div>
                  <label for="mapjsonurl">Map json_url: </label>
                  <input type="text" name="mapjsonurl" [(ngModel)]="editableMap!.jsonUrl" required placeholder="Enter the url">
                </div>
                <div>
                  <label for="mapstatus">Map Status:</label>
                  <mat-slide-toggle id="toggle-Button" name="mapstatus" [(ngModel)]="editableMap!.active" [checked]="editableMap!.active" (click)="onStatusChange(editableMap!.active)"></mat-slide-toggle>
                </div>
                <div>
                  <label for="mapvisiblity">Map Visiblity:</label>
                  <select name="mapvisiblity" id="mapvisiblity"[(ngModel)]="editableMap!.visibility">
                    <option value="public">Public</option>
                    <option value="private">Private</option>
                  </select>
                </div>
                <div class="updates-btn">
                  <button class="btn btn-secondary" (click)="cancelEdit()" type="button">Cancel</button>
                  <button class="btn btn-primary validation-btn" type="submit"  [disabled]="postForm.form.invalid">Save</button>
                </div>
              </form>

            </div>
            }

          </div>
        </div>
      </div>
    </section>


    <aside class="sidebar">

      <div class="glass-panel widget">
        <h3>Total Maps</h3>
        <div class="stat-content">
          <div class="big-number">{{totalMaps}}</div>
          <!-- <div class="stat-trend positive">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
              <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
              <polyline points="17 6 23 6 23 12"></polyline>
            </svg>
            +12% from last month
          </div> -->
        </div>
      </div>

      <div class="glass-panel widget">
        <h3>Maps Created This Week</h3>
        <div class="chart-container bar-chart">
          <div class="bar" style="height: 40%" title="Mon"></div>
          <div class="bar" style="height: 70%" title="Tue"></div>
          <div class="bar" style="height: 50%" title="Wed"></div>
          <div class="bar" style="height: 90%" title="Thu"></div>
          <div class="bar" style="height: 60%" title="Fri"></div>
          <div class="bar" style="height: 30%" title="Sat"></div>
          <div class="bar" style="height: 50%" title="Sun"></div>
        </div>
        <div class="chart-labels">
          <span>M</span><span>T</span><span>W</span><span>T</span><span>F</span><span>S</span><span>S</span>
        </div>
      </div>

      <!-- <div class="glass-panel widget">
        <h3>Map Views This Week</h3>
        <div class="chart-container line-chart-wrapper">
          <svg viewBox="0 0 100 50" class="line-chart-svg">
            <polyline fill="none" stroke="#D90445" stroke-width="2" points="0,40 20,20 40,30 60,10 80,15 100,5" />
            <circle cx="0" cy="40" r="1.5" fill="#fff" />
            <circle cx="20" cy="20" r="1.5" fill="#fff" />
            <circle cx="40" cy="30" r="1.5" fill="#fff" />
            <circle cx="60" cy="10" r="1.5" fill="#fff" />
            <circle cx="80" cy="15" r="1.5" fill="#fff" />
            <circle cx="100" cy="5" r="1.5" fill="#fff" />
          </svg>
        </div>
      </div> -->

    </aside>

  </div>
</div>